@model CampusIssueReporting.Models.Issue
@using CampusIssueReporting.Models
@{
    ViewData["Title"] = "Issue Details (Admin)";
}

<h2>Issue #@Model.Id - @Model.Title</h2>
<p class="small text-muted">Reporter: @Model.Reporter?.UserName (@Model.Reporter?.Email) â€¢ Created: @Model.CreatedAt.ToLocalTime().ToString("g")</p>

<p><strong>Category:</strong> @Model.Category?.Name</p>
<p><strong>Status:</strong> @Model.Status</p>
<p><strong>Priority:</strong> @Model.Priority</p>
<p><strong>Assigned Admin:</strong> @Model.AssignedAdmin?.UserName ?? "Unassigned"</p>

<hr />

<p>@Html.Raw(Html.Encode(Model.Description).Replace("\n","<br/>"))</p>

@if (Model.Files != null && Model.Files.Any())
{
    <h5>Attachments</h5>
    <div class="d-flex flex-wrap">
        @foreach (var f in Model.Files)
        {
            <div class="me-3 mb-3">
                @if (!string.IsNullOrEmpty(f.FileUrl) && (f.FileUrl.EndsWith(".jpg") || f.FileUrl.EndsWith(".png") || f.FileUrl.EndsWith(".jpeg") || f.FileUrl.EndsWith(".gif")))
                {
                    <img src="@f.FileUrl" alt="@f.FileName" style="max-width:240px;max-height:160px;display:block;border:1px solid #ddd;padding:4px;border-radius:6px;" />
                }
                <div class="mt-1">
                    <a asp-controller="Issue" asp-action="DownloadFile" asp-route-id="@f.Id">Download</a>
                </div>
            </div>
        }
    </div>
}

@if (Model.Comments != null && Model.Comments.Any())
{
    <h5>Comments (@Model.Comments.Count)</h5>
    <div class="list-group mb-3">
        @foreach (var c in Model.Comments.OrderBy(c => c.CreatedAt))
        {
            <div class="list-group-item">
                <strong>@c.User?.UserName</strong> <small class="text-muted">@c.CreatedAt.ToLocalTime().ToString("g")</small>
                <div>@c.Content</div>
            </div>
        }
    </div>
}
